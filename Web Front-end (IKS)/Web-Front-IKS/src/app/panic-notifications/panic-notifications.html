<div class="page">
	<div class="card">
		<div class="header">
			<div>
				<h2 class="title">Panic Notifications - Admin</h2>
				<p class="subtitle">Monitor all panic notifications from riders and drivers, filter by date, and sort by any field.</p>
			</div>
		</div>

		<form class="filters" [formGroup]="filterForm">
			<mat-form-field appearance="outline" class="typing-fields">
				<mat-label>From date</mat-label>
				<input matInput [matDatepicker]="fromPicker" formControlName="fromDate">
				<mat-datepicker-toggle matIconSuffix [for]="fromPicker"></mat-datepicker-toggle>
				<mat-datepicker #fromPicker></mat-datepicker>
			</mat-form-field>

			<mat-form-field appearance="outline" class="typing-fields">
				<mat-label>To date</mat-label>
				<input matInput [matDatepicker]="toPicker" formControlName="toDate">
				<mat-datepicker-toggle matIconSuffix [for]="toPicker"></mat-datepicker-toggle>
				<mat-datepicker #toPicker></mat-datepicker>
			</mat-form-field>
            
			<div class="filter-actions">
				<button mat-raised-button color="primary" type="button" (click)="applyFilters()">Apply</button>
				<button mat-stroked-button type="button" (click)="clearFilters()">Clear</button>
			</div>
		</form>

		<div class="table-wrap">
			<table mat-table [dataSource]="panics" matSort (matSortChange)="onSortChange($event)" class="panics-table">

				<ng-container matColumnDef="id">
					<th mat-header-cell *matHeaderCellDef mat-sort-header>Panic ID</th>
					<td mat-cell *matCellDef="let panic">{{ panic.id }}</td>
				</ng-container>

				<ng-container matColumnDef="callerId">
					<th mat-header-cell *matHeaderCellDef mat-sort-header>Caller ID</th>
					<td mat-cell *matCellDef="let panic">{{ panic.callerId }}</td>
				</ng-container>

				<ng-container matColumnDef="callerName">
					<th mat-header-cell *matHeaderCellDef mat-sort-header>Caller Name</th>
					<td mat-cell *matCellDef="let panic">{{ panic.callerName }}</td>
				</ng-container>

				<ng-container matColumnDef="rideId">
					<th mat-header-cell *matHeaderCellDef mat-sort-header>Ride ID</th>
					<td mat-cell *matCellDef="let panic">{{ panic.rideId }}</td>
				</ng-container>

				<ng-container matColumnDef="createdAt">
					<th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
					<td mat-cell *matCellDef="let panic">{{ formatDateTime(panic.createdAt) }}</td>
				</ng-container>

				<ng-container matColumnDef="resolved">
					<th mat-header-cell *matHeaderCellDef mat-sort-header>Resolved</th>
					<td mat-cell *matCellDef="let panic">
						<span class="badge" [class.badge-resolved]="panic.resolved" [class.badge-unresolved]="!panic.resolved">
							{{ formatResolved(panic.resolved) }}
						</span>
					</td>
				</ng-container>

				<ng-container matColumnDef="resolvedAt">
					<th mat-header-cell *matHeaderCellDef mat-sort-header>Resolved At</th>
					<td mat-cell *matCellDef="let panic">{{ formatDateTime(panic.resolvedAt) }}</td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
				<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
			</table>
		</div>

		<div class="state" *ngIf="loading">
			<mat-progress-spinner mode="indeterminate" diameter="36"></mat-progress-spinner>
			<span>Loading panic notifications...</span>
		</div>

		<div class="state error" *ngIf="error">{{ error }}</div>

		<div class="state" *ngIf="!loading && !error && panics.length === 0">
			<span>No panic notifications found.</span>
		</div>

		<mat-paginator
			[length]="totalElements"
			[pageIndex]="pageIndex"
			[pageSize]="pageSize"
			[pageSizeOptions]="[5, 10, 25, 50]"
			(page)="onPageChange($event)">
		</mat-paginator>
	</div>
</div>
